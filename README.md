# Voice-to-Voice Translator (RU → EN)

Полностью офлайн desktop-приложение для перевода русской речи на английский с сохранением характеристик голоса.

## Возможности

- ✅ **Полностью офлайн**: Работает без интернета
- ✅ **Распознавание речи**: Автоматическое распознавание русской речи (ASR)
- ✅ **Контекстный перевод**: Перевод с русского на английский с учетом контекста
- ✅ **Клонирование голоса**: Генерация английской речи вашим голосом
- ✅ **Синхронизация**: Сохранение длительности, пауз и интонации
- ✅ **Видео поддержка**: Работа с аудио и видео файлами
- ✅ **GPU ускорение**: Поддержка CUDA (NVIDIA) и CPU режима

## Системные требования

### Минимальные требования
- **ОС**: Windows 10/11 или macOS 10.15+
- **Процессор**: Intel Core i5 или аналог
- **Оперативная память**: 8 GB RAM
- **Место на диске**: 10 GB свободного места для моделей
- **Python**: 3.8 или выше

### Рекомендуемые требования
- **Процессор**: Intel Core i7/AMD Ryzen 7 или выше
- **Оперативная память**: 16 GB RAM
- **GPU**: NVIDIA GPU с 6GB+ VRAM (для ускорения)
- **Место на диске**: 15 GB свободного места

## Установка

### 1. Клонируйте репозиторий или скачайте файлы

```bash
cd voicechanger
```

### 2. Создайте виртуальное окружение

```bash
# macOS/Linux
python3 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

### 3. Установите зависимости

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 4. Установите ffmpeg

#### macOS:
```bash
brew install ffmpeg
```

#### Windows:
1. Скачайте ffmpeg с https://ffmpeg.org/download.html
2. Распакуйте и добавьте в PATH

#### Linux:
```bash
sudo apt-get install ffmpeg  # Ubuntu/Debian
sudo yum install ffmpeg      # CentOS/RHEL
```

### 5. (Опционально) Для GPU ускорения

#### NVIDIA CUDA (Windows/Linux):
```bash
# Сначала установите CUDA Toolkit с nvidia.com
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

## Использование

### Запуск приложения

```bash
python main.py
```

### Интерфейс приложения

1. **Загрузка файла**: Нажмите "Load File" и выберите аудио/видео файл
   - Поддерживаемые форматы: MP4, MOV, MKV, AVI, WAV, MP3, FLAC, OGG, M4A

2. **Референс голоса** (опционально): Нажмите "Load Reference"
   - Загрузите образец вашего голоса (5-20 секунд чистой записи)
   - Для лучшего качества используйте WAV формат

3. **Настройки**:
   - **Режим перевода**:
     - Быстрый: Быстрая обработка
     - Контекстный: Максимальное качество перевода
   - **Синхронизация длительности**: Подгоняет длительность под оригинал
   - **Использовать GPU**: Включает GPU ускорение (если доступно)

4. **Обработка**: Нажмите "Обработать"
   - Следите за прогрессом в окне логов
   - Процесс может занять от нескольких минут до часа в зависимости от длины файла

5. **Результат**: После завершения:
   - Переведенный файл сохранится в папке `output/`
   - Нажмите "Открыть папку с результатами" для просмотра

### Первый запуск

При первом запуске приложение автоматически скачает необходимые модели:
- Whisper (ASR) - ~3 GB
- NLLB (перевод) - ~2.5 GB
- XTTS-v2 (TTS) - ~1.8 GB

Общий размер: ~7-8 GB. Скачивание может занять время в зависимости от скорости интернета.

После скачивания приложение работает полностью офлайн.

## Структура проекта

```
voicechanger/
├── main.py                 # Главный файл запуска
├── config.py              # Конфигурация приложения
├── requirements.txt       # Зависимости Python
├── src/
│   ├── modules/           # Модули обработки
│   │   ├── audio_processor.py      # Аудиообработка
│   │   ├── asr_processor.py        # Распознавание речи
│   │   ├── translation_processor.py # Перевод
│   │   └── tts_processor.py        # Синтез речи
│   └── ui/
│       └── main_window.py  # GUI интерфейс
├── models/                # Локальные модели (создается автоматически)
├── downloads/             # Временные файлы
├── output/                # Результаты обработки
└── logs/                  # Логи приложения
```

## Конфигурация

Настройки находятся в файле `config.py`. Основные параметры:

### ASR (Распознавание речи)
```python
ASR_CONFIG = {
    "model_name": "large-v3",  # tiny, base, small, medium, large-v2, large-v3
    "device": "auto",           # auto, cpu, cuda
    "compute_type": "float16",  # float16, int8, float32
}
```

### Translation (Перевод)
```python
TRANSLATION_CONFIG = {
    "model_name": "facebook/nllb-200-distilled-1.3B",
    "source_lang": "rus_Cyrl",
    "target_lang": "eng_Latn",
}
```

### TTS (Синтез речи)
```python
TTS_CONFIG = {
    "model_name": "tts_models/multilingual/multi-dataset/xtts_v2",
    "language": "en",
    "speaker_wav": None,  # Путь к референсу голоса
}
```

## Производительность

### Примерное время обработки (для 1 минуты аудио):

| Конфигурация | ASR | Перевод | TTS | Итого |
|--------------|-----|---------|-----|-------|
| CPU (Fast) | ~30s | ~10s | ~45s | ~1.5 мин |
| CPU (Quality) | ~60s | ~15s | ~45s | ~2 мин |
| GPU (Fast) | ~10s | ~5s | ~15s | ~30s |
| GPU (Quality) | ~20s | ~8s | ~15s | ~43s |

*Время зависит от оборудования и может отличаться

## Советы по улучшению качества

1. **Референс голоса**:
   - Используйте чистую запись без фонового шума
   - Длительность 10-20 секунд оптимальна
   - Говорите естественно, с разной интонацией

2. **Качество входного аудио**:
   - Используйте файлы с минимальным фоновым шумом
   - Рекомендуемый формат: WAV 16kHz mono
   - Избегайте сильных эхо и реверберации

3. **Режим обработки**:
   - Для коротких фраз используйте "Быстрый" режим
   - Для длинных разговоров используйте "Контекстный" режим

## Устранение проблем

### Приложение не запускается
```bash
# Проверьте версию Python
python --version  # Должна быть 3.8+

# Переустановите зависимости
pip install --upgrade -r requirements.txt
```

### Ошибка "ffmpeg not found"
- Убедитесь, что ffmpeg установлен и доступен в PATH
- Проверьте: `ffmpeg -version`

### GPU не используется
```bash
# Проверьте CUDA
python -c "import torch; print(torch.cuda.is_available())"

# Если False, переустановите PyTorch с CUDA
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### Недостаточно памяти
- Используйте модель меньшего размера (medium вместо large-v3)
- Измените `compute_type` на `int8` в config.py
- Закройте другие приложения

### Плохое качество голоса
- Используйте лучший референс голоса (без шума, длиннее)
- Убедитесь, что входное аудио хорошего качества
- Попробуйте режим "Контекстный"

## Лицензия

Этот проект использует открытые модели и библиотеки:
- Whisper (OpenAI) - MIT License
- NLLB (Meta) - CC-BY-NC 4.0
- Coqui TTS - MPL 2.0

## Поддержка

Для вопросов и проблем создайте issue в репозитории.

## Roadmap

- [ ] Поддержка RVC для улучшения клонирования голоса
- [ ] Пакетная обработка нескольких файлов
- [ ] Редактирование перевода перед синтезом
- [ ] Экспорт субтитров на обоих языках
- [ ] Поддержка дополнительных языков
- [ ] Создание standalone приложения (.exe/.app)

---

**Примечание**: Первый запуск требует подключения к интернету для скачивания моделей. После этого приложение работает полностью офлайн.
