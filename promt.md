# Offline Voice-to-Voice Translation Application (RU → EN)
## Полное техническое задание (Windows + macOS)

---

# 1. Назначение системы

Разработать полностью офлайн desktop-приложение для Windows и macOS, которое:

1. Принимает аудио или видео файл с русской речью пользователя (мой голос).
2. Выполняет автоматическое распознавание речи (ASR).
3. Выполняет контекстный перевод с русского на английский.
4. Генерирует английскую речь моим голосом.
5. Сохраняет интонацию, ритм и паузы максимально близко к оригиналу.
6. Экспортирует финальный аудио или видео файл с новой дорожкой.

Приложение предназначено исключительно для работы с моим голосом. Я даю согласие на использование и обучение голосовой модели.

Работа полностью офлайн — без облачных сервисов и API.

---

# 2. Платформенные требования

Поддерживаемые ОС:
- Windows 10/11 (x64)
- macOS (Intel + Apple Silicon)

Требования:
- Работа без подключения к интернету
- Поддержка CPU режима
- Поддержка GPU (CUDA для NVIDIA, Metal для macOS)
- Нативный внешний вид интерфейса

---

# 3. UI Требования

## Основной вариант:
PyQt6

## Альтернатива:
Tkinter + ttk

---

## Интерфейс должен включать:

- Кнопка: «Загрузить файл»
- Поддержка форматов: mp4, mov, mkv, wav, mp3, flac
- Отображение пути к файлу
- Выпадающий список режима перевода:
  - Быстрый
  - Контекстный (максимальное качество)
- Чекбокс:
  - Синхронизировать длительность с оригиналом
- Чекбокс:
  - Использовать GPU (если доступен)
- Кнопка: «Обработать»
- Прогресс-бар
- Лог-окно выполнения этапов
- Кнопка: «Экспорт результата»

UI не должен зависать во время обработки.

---

# 4. Полностью офлайн архитектура

- Все модели скачиваются и хранятся локально
- Никаких внешних API
- Никакой передачи данных
- Обработка выполняется локально

---

# 5. Пайплайн обработки

---

## 5.1 Извлечение аудио

Инструмент:
- ffmpeg (локально установленный)

Если вход — видео:
- Извлечь аудио
- Конвертировать в WAV
- 16kHz
- mono

---

## 5.2 Очистка речи (опционально)

Инструменты:
- Demucs v4
или
- RNNoise

Назначение:
- Удаление фоновой музыки
- Удаление шума

---

## 5.3 Распознавание речи (ASR)

### Назначение
Модуль ASR выполняет автоматическое распознавание русской речи из аудиофайла и возвращает:

- Полный текст
- Сегменты речи
- Таймкоды начала и конца каждого сегмента
- Длительность сегментов
- Паузы между сегментами
- Пунктуацию

Работа полностью офлайн.

---

### Основной рекомендуемый стек

Движок:
faster-whisper
Модель:
openai/whisper-large-v3
Причины выбора:
- Лучшее качество распознавания русского языка
- Устойчивость к шуму
- Корректная пунктуация
- Поддержка сегментации
- Поддержка GPU (CUDA)
- Поддержка INT8/FP16 оптимизации

---

### Альтернативные модели

Если ограничена видеопамять:
openai/whisper-medium
Если работа только на CPU:
whisper.cpp (medium)
---

### Требования к обработке

1. Аудио должно быть:
   - WAV
   - 16kHz
   - mono

2. Поддержка длинных файлов (разбиение на чанки).

3. Поддержка:
   - VAD (voice activity detection)
   - Автоматического определения языка (опционально)

4. Возможность выбора precision:
   - FP16 (GPU)
   - INT8 (оптимизированный режим)
   - FP32 (CPU fallback)

---

### Выходной формат данных

ASR должен возвращать структуру:

- text: полный распознанный текст
- segments:
  - start_time
  - end_time
  - duration
  - text
  - confidence (если доступно)

---

### Производительность

- Поддержка CUDA для NVIDIA
- Поддержка Metal для macOS (если возможно)
- Асинхронная обработка
- UI не блокируется во время распознавания

---

### Дополнительные требования

- Возможность сохранения промежуточного результата
- Экспорт текста в .txt
- Экспорт субтитров в .srt
- Логирование ошибок
- Корректная обработка фонового шума

---

### Итоговая конфигурация (рекомендуемая)

CPU-версия:
Helsinki-NLP/opus-mt-ru-en
Требования к переводу:
- Учитывать контекст соседних сегментов
- Объединять логически связанные предложения
- Избегать дословного перевода
- Сохранять разговорный стиль
- Сохранять эмоциональный оттенок

---

## 5.5 Генерация английской речи (TTS)

### Основная модель:
coqui/XTTS-v2
Требования:
- Поддержка английского языка
- Поддержка reference audio
- Поддержка voice cloning
- Возможность использовать sample моего голоса

---

## 5.6 Voice Conversion (для максимальной похожести)

Инструмент:
RVC (Retrieval-based Voice Conversion)
Требования:
- Локальное обучение модели моего голоса
- 5–20 минут чистой записи для обучения
- Сохранение тембра
- Перенос интонации
- Перенос характера речи

Pipeline:
1. Генерация английской речи нейтральным голосом
2. Преобразование через RVC в мой голос

---

## 5.7 Синхронизация

Требования:
- Сохранение пауз
- Подгон длительности сегментов
- Time-stretching
- Dynamic speed matching
- Совпадение таймкодов

Инструменты:
- ffmpeg
- librosa
- pydub

---

## 5.8 Экспорт результата

Если вход — видео:
- Замена аудиодорожки через ffmpeg
- Экспорт в mp4

Если вход — аудио:
- Экспорт в wav или mp3

Дополнительно:
- Генерация субтитров (.srt)

---

# 6. Производительность

- Поддержка CUDA (NVIDIA)
- Поддержка Metal (macOS)
- FP16 режим
- INT8 режим
- Асинхронная обработка
- UI поток отделён от вычислений

---

# 7. Требования к качеству

Система должна:

- Корректно распознавать разговорную русскую речь
- Делать контекстный перевод
- Генерировать естественную английскую речь
- Максимально сохранять:
  - Темп
  - Паузы
  - Эмоциональную окраску
  - Интонацию
  - Характер речи

---

# 8. Сборка приложения

Инструменты:
- PyInstaller
или
- Briefcase

Результат:
- .exe для Windows
- .app для macOS

---

# 9. Дополнительные функции

- Редактирование перевода перед синтезом
- Настройка скорости речи
- Настройка эмоциональности
- Повторная генерация сегмента
- Логирование этапов обработки
- Сохранение промежуточных файлов

---

# 10. Финальный рекомендуемый стек

ASR:
faster-whisper + large-v3
Precision:
- FP16 (при наличии GPU)
- INT8 (при ограниченной памяти)
- CPU fallback

Перевод:
facebook/nllb-200-distilled-1.3B
Альтернатива:
facebook/nllb-200-distilled-600M
TTS:
coqui/XTTS-v2
Voice Conversion:
RVC (обученная модель моего голоса)
Аудиообработка:
ffmpeg
librosa
pydub
Demucs
---

# 11. Итоговые требования

Приложение должно:

- Работать полностью офлайн
- Поддерживать Windows и macOS
- Использовать PyQt6 или Tkinter + ttk
- Переводить RU → EN
- Генерировать английскую речь моим голосом
- Сохранять интонацию и ритм
- Работать на CPU и GPU
- Не использовать облачные сервисы
- Поддерживать масштабируемость и расширение функционала